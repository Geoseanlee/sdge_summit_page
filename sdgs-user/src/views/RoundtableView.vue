<template>
  <div class="roundtable">
    <!-- ä¸»è¦å†…å®¹ -->
    <div class="roundtable-content">
      <div class="container">
        <!-- ä¼šè®®è¯¦ç»†ä»‹ç»ï¼ˆå¦‚å›¾2ï¼‰ -->
        <section class="forum-intro-section">
          <h2 class="forum-intro-title">â€œä¸–åšå…¨çƒé’å¹´å…±åˆ›ç§‘å­¦ä¸è‰ºæœ¯å¯æŒç»­æœªæ¥â€</h2>
          <div class="forum-intro-content">
            <p>ä¸–ç•Œåšè§ˆä¼šï¼ˆä¸–åšä¼šï¼‰æ˜¯ç”±å›½å®¶æ”¿åºœä¸»åŠã€å¤šå›½å’Œå›½é™…ç»„ç»‡å‚ä¸çš„å…¨çƒæœ€é«˜çº§åˆ«å±•è§ˆå¹³å°ï¼Œæ—¨åœ¨é€šè¿‡å±•ç¤ºå„å›½çš„ç§‘æŠ€åˆ›æ–°ã€æ–‡åŒ–æˆå°±å’Œç»æµæˆæœï¼Œä¿ƒè¿›å…¨çƒåˆä½œä¸äº¤æµã€‚å…¶æ ¸å¿ƒç†å¿µä¸ºâ€œç†è§£ã€æ²Ÿé€šã€æ¬¢èšã€åˆä½œâ€ï¼Œè‡´åŠ›äºå¢è¿›å„å›½äººæ°‘ä¹‹é—´çš„ç›¸äº’ç†è§£ï¼Œæ¨åŠ¨å…¨çƒå¯æŒç»­å‘å±•ã€‚</p>
            <p>ä¸–åšä¼šä¸ä»…æ˜¯äººç±»æ–‡æ˜æˆå°±çš„å±•ç¤ºèˆå°ï¼Œæ›´æ˜¯æ¢è®¨å…¨çƒæ€§æŒ‘æˆ˜ã€å¯»æ±‚è§£å†³æ–¹æ¡ˆçš„é‡è¦å¹³å°ï¼Œæ¯ä¸€å±Šéƒ½å›´ç»•ç‰¹å®šä¸»é¢˜å±•å¼€ï¼Œèšç„¦åŸå¸‚åŒ–ã€å¯æŒç»­å‘å±•ã€ç§‘æŠ€åˆ›æ–°ç­‰é‡å¤§é—®é¢˜ã€‚è¢«èª‰ä¸ºâ€œç»æµã€ç§‘æŠ€ä¸æ–‡åŒ–çš„å¥¥æ—åŒ¹å…‹â€ï¼Œæ˜¯äººç±»æ–‡æ˜æˆæœçš„é›†ä¸­å±•ç¤ºå¹³å°ã€‚</p>
            <ul class="forum-intro-list">
              <li>å“ç‰Œ&é’å¹´é¢†è¢–æ¿å—ï¼šå°†å±•ç¤ºåˆ›æ–°ä¸å¯æŒç»­å®è·µï¼Œä»¥åŠé’å¹´é¢†è¢–æ¿å—æ±‡èšå…¨çƒå½±å“åŠ›äººç‰©ï¼›</li>
              <li>æœªæ¥æ•™è‚²æ¿å—ï¼šæ¢è®¨æœªæ¥äººæ‰åŸ¹å…»ï¼Œä¿ƒè¿›æœªæ¥å’Œå¯æŒç»­å‘å±•çš„ä¸“ä¸šä¸å­¦æœ¯æˆæœï¼›</li>
              <li>è‰ºæœ¯ç–—æ„ˆæ¿å—ï¼šå°†ä¼ ç»Ÿéç‰©è´¨æ–‡åŒ–é—äº§ä¸ç°ä»£ç§‘æŠ€ç›¸ç»“åˆï¼Œé€šè¿‡åˆ›æ–°çš„è‰ºæœ¯è¡¨ç°å½¢å¼ï¼Œæ¢ç´¢è‰ºæœ¯åœ¨å¿ƒç†å¥åº·å’Œæƒ…æ„Ÿç–—æ„ˆä¸­çš„ç‹¬ç‰¹ä½œç”¨ï¼›</li>
              <li>å¥³æ€§æ¿å—ï¼šå°†èšç„¦å¥³æ€§åœ¨å¯æŒç»­å‘å±•ä¸­çš„å…³é”®è§’è‰²ï¼Œä¿ƒè¿›æ€§åˆ«å¹³ç­‰ï¼Œèµ‹èƒ½æ›´å¤šå¥³æ€§åœ¨å¤šé¢†åŸŸå‘æŒ¥é¢†å¯¼åŠ›ä¸å½±å“åŠ›ï¼Œæˆä¸ºå˜é©æ¨åŠ¨è€…ã€‚</li>
              <li>ESGæ¿å—ï¼šèšç„¦ç¯å¢ƒã€ç¤¾ä¼šå’Œæ²»ç†ä¸‰å¤§æ ¸å¿ƒé¢†åŸŸå…±åŒæ¢ç´¢å¦‚ä½•é€šè¿‡ç»¿è‰²æŠ€æœ¯ã€ç¤¾ä¼šè´£ä»»å’Œé€æ˜æ²»ç†ï¼Œæ„å»ºæ›´å…·éŸ§æ€§å’Œå¯æŒç»­çš„æœªæ¥ç”Ÿæ€ã€‚</li>
            </ul>
          </div>
        </section>

        <!-- çƒ­é—¨è®¨è®ºä¸»é¢˜ -->
        <section class="discussion-topics">
          <div class="topics-grid topics-vertical">
            <div
              v-for="topic in discussionTopics"
              :key="topic.id"
              class="topic-card topic-card-large-icon"
            >
              <div class="topic-icon-large">{{ topic.icon }}</div>
              <h3>{{ topic.title }}</h3>
              <p>{{ topic.description }}</p>
              <div class="topic-stats">
                <span>{{ topic.participants }} äººå‚ä¸</span>
                <span>{{ topic.discussions }} æ¡è®¨è®º</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { Clock, Location } from '@element-plus/icons-vue'
import request from '@/utils/request'

// å“åº”å¼æ•°æ®
const upcomingMeetings = ref([])
const pastMeetings = ref([])
const discussionTopics = ref([
  {
    id: 1,
    icon: 'ğŸŒ',
    title: 'å…¨çƒåˆä½œä¸ä¼™ä¼´å…³ç³»',
    description: 'å¦‚ä½•åŠ å¼ºå›½é™…åˆä½œï¼Œå»ºç«‹æœ‰æ•ˆçš„å…¨çƒä¼™ä¼´å…³ç³»',
    participants: 156,
    discussions: 89,
  },
  {
    id: 2,
    icon: 'ğŸ’¡',
    title: 'åˆ›æ–°æŠ€æœ¯ä¸å¯æŒç»­å‘å±•',
    description: 'æ¢è®¨äººå·¥æ™ºèƒ½ã€åŒºå—é“¾ç­‰æ–°æŠ€æœ¯åœ¨SDGä¸­çš„åº”ç”¨',
    participants: 203,
    discussions: 127,
  },
  {
    id: 3,
    icon: 'ğŸ“',
    title: 'æ•™è‚²ä¸èƒ½åŠ›å»ºè®¾',
    description: 'æå‡å…¨æ°‘å¯æŒç»­å‘å±•æ„è¯†å’Œèƒ½åŠ›çš„ç­–ç•¥',
    participants: 178,
    discussions: 95,
  },
  {
    id: 4,
    icon: 'ğŸ¢',
    title: 'ä¼ä¸šç¤¾ä¼šè´£ä»»',
    description: 'ä¼ä¸šåœ¨å®ç°SDGä¸­çš„ä½œç”¨å’Œè´£ä»»',
    participants: 145,
    discussions: 73,
  },
])

// è·å–ä¼šè®®æ•°æ®
const fetchMeetings = async () => {
  try {
    // è·å–å³å°†ä¸¾è¡Œçš„ä¼šè®®
    const upcomingRes = await request.get('/forums', {
      params: { status: 'UPCOMING' }
    })
    upcomingMeetings.value = (upcomingRes || []).map(meeting => ({
      ...meeting,
      day: new Date(meeting.startTime).getDate(),
      month: new Date(meeting.startTime).toLocaleString('en-US', { month: 'short' }).toUpperCase(),
      time: `${new Date(meeting.startTime).toLocaleTimeString()} - ${new Date(meeting.endTime).toLocaleTimeString()}`,
      speakers: meeting.speakers ? meeting.speakers.split(',') : []
    }))

    // è·å–å†å²ä¼šè®®
    const pastRes = await request.get('/forums', {
      params: { status: 'PAST' }
    })
    pastMeetings.value = (pastRes || []).map(meeting => ({
      ...meeting,
      date: new Date(meeting.startTime).toLocaleDateString('zh-CN')
    }))
  } catch (error) {
    ElMessage.error('è·å–ä¼šè®®æ•°æ®å¤±è´¥')
    console.error(error)
  }
}

// æ–¹æ³•
const registerMeeting = async (meeting) => {
  try {
    await request.post(`/forums/${meeting.id}/register`)
    ElMessage.success(`å·²æˆåŠŸæŠ¥åï¼š${meeting.title}`)
  } catch (error) {
    ElMessage.error('æŠ¥åå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  }
}

const viewDetails = (meeting) => {
  ElMessage.info(`æŸ¥çœ‹ä¼šè®®è¯¦æƒ…ï¼š${meeting.title}`)
}

const watchRecording = (meeting) => {
  ElMessage.info(`è§‚çœ‹ä¼šè®®å›æ”¾ï¼š${meeting.title}`)
}

// é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
onMounted(() => {
  fetchMeetings()
})
</script>

<style scoped>
.roundtable {
  min-height: 100vh;
  background-color: #f8f9fa;
}

.page-header {
  background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
  color: white;
  padding: 60px 0 40px 0;
  text-align: center;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.page-header h1 {
  font-size: 3rem;
  margin-bottom: 1rem;
  font-weight: 700;
}

.page-header p {
  font-size: 1.2rem;
  opacity: 0.9;
}

.roundtable-content {
  padding: 40px 0 0 0;
}

section {
  margin-bottom: 60px;
}

section h2 {
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 2rem;
  color: #333;
  text-align: center;
}

.overview-text {
  font-size: 1.1rem;
  line-height: 1.8;
  color: #666;
  text-align: center;
  max-width: 800px;
  margin: 0 auto;
}

.meetings-grid {
  display: grid;
  gap: 30px;
}

.forum-card {
  display: flex;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.07);
  overflow: hidden;
  margin-bottom: 32px;
  min-height: 160px;
}

.forum-card-left {
  background: linear-gradient(135deg, #b2d8f7 0%, #e0c3fc 100%);
  padding: 24px 32px;
  min-width: 320px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.forum-card-title {
  font-size: 1.2rem;
  font-weight: bold;
  color: #1e3a8a;
  margin-bottom: 8px;
}

.forum-card-en-title {
  font-size: 0.95rem;
  color: #333;
  margin-bottom: 16px;
}

.forum-card-info {
  font-size: 0.95rem;
  color: #444;
  line-height: 1.7;
}

.forum-card-right {
  flex: 1;
  padding: 24px 32px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
}

.forum-card-topic {
  font-size: 1.1rem;
  font-weight: 600;
  color: #1e3a8a;
  margin-bottom: 12px;
}

.forum-card-tags {
  margin-bottom: 18px;
}

.forum-card-tag {
  display: inline-block;
  background: #e0f2fe;
  color: #0284c7;
  border-radius: 12px;
  padding: 2px 12px;
  font-size: 0.9rem;
  margin-right: 8px;
}

.forum-card-btn {
  align-self: flex-end;
}

.past-meetings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 20px;
}

.past-meeting-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}

.past-meeting-card:hover {
  transform: translateY(-2px);
}

.past-meeting-image {
  height: 200px;
  background: #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
}

.past-meeting-content {
  padding: 20px;
}

.past-meeting-content h3 {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.past-meeting-date {
  color: #999;
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.past-meeting-summary {
  color: #666;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.topics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 32px;
  justify-items: center;
}

.topic-card {
  background: white;
  padding: 32px 20px 24px 20px;
  border-radius: 16px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.07);
  text-align: center;
  transition: all 0.3s ease;
  min-width: 240px;
  min-height: 180px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.topic-card-large-icon .topic-icon-large {
  font-size: 2.8rem;
  margin-bottom: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.topic-card h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 10px;
  color: #222;
}

.topic-card p {
  color: #666;
  line-height: 1.5;
  margin-bottom: 16px;
  font-size: 0.98rem;
}

.topic-stats {
  display: flex;
  justify-content: center;
  gap: 18px;
  font-size: 0.95rem;
  color: #999;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .page-header h1 {
    font-size: 2rem;
  }
  .forum-intro-section {
    padding: 0 8px;
  }
  .discussion-topics {
    padding: 0 8px;
  }
  .topics-grid {
    gap: 16px;
  }
}

.topics-vertical {
  display: flex;
  flex-direction: column;
  gap: 32px;
  align-items: center;
}
</style> 